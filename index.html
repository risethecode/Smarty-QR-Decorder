<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced UPI QR Decoder</title>

<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background: linear-gradient(-45deg,#89f7fe,#66a6ff,#c2e9fb,#a1c4fd);
    background-size:400% 400%;
    animation:gradientBG 12s ease infinite;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}
@keyframes gradientBG{
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
}
.container{
    width:90%;
    max-width:900px;
    background:rgba(255,255,255,0.25);
    backdrop-filter: blur(20px);
    padding:30px;
    border-radius:20px;
    box-shadow:0 15px 40px rgba(0,0,0,0.3);
    animation:fadeIn 1s ease-in-out;
}
h1{
    text-align:center;
    font-size:28px;
    color:#003366;
}
.brand{
    text-align:center;
    font-size:22px;
    font-weight:bold;
    color:#002244;
    margin-bottom:15px;
    letter-spacing:1px;
}
.upload-box{
    border:2px dashed #003366;
    padding:25px;
    text-align:center;
    border-radius:15px;
    cursor:pointer;
    transition:0.3s;
}
.upload-box:hover{
    background:rgba(255,255,255,0.4);
}
.file-info{
    margin-top:10px;
    font-weight:bold;
    color:#003366;
}
button{
    padding:10px 18px;
    border:none;
    border-radius:8px;
    font-weight:bold;
    cursor:pointer;
    margin:8px 5px;
    transition:0.3s;
}
.decode-btn{
    background:#ff9800;
    color:black;
}
.decode-btn:hover{transform:scale(1.05);}
.copy-btn{
    background:#28a745;
    color:white;
}
.copy-btn:hover{transform:scale(1.05);}
.choose-btn{
    background:#007bff;
    color:white;
}
#output{
    margin-top:20px;
    background:white;
    padding:20px;
    border-radius:10px;
    color:black;
    white-space:pre-wrap;
    max-height:300px;
    overflow:auto;
}
video{
    width:100%;
    border-radius:10px;
    margin-top:10px;
}
@keyframes fadeIn{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
}
</style>
</head>

<body>

<div class="container">

<div class="brand">Powerd by: ğ™ğ™¢ğ™–ğ™§ğ™©ğ™® ğ™ˆğ™</div>

<h1>ğŸš€ Advanced UPI QR Decoder</h1>

<div class="upload-box" onclick="document.getElementById('fileInput').click()">
Click or Drag & Drop File (Image / PDF)
<input type="file" id="fileInput" accept="image/*,.pdf" hidden onchange="showFileName(this)">
</div>

<div class="file-info" id="fileName"></div>

<div style="text-align:center;">
<button class="decode-btn" onclick="decodeQR()">Decode Now</button>
<button class="decode-btn" onclick="startCamera()">Live Camera Scan</button>
<button class="choose-btn" onclick="chooseAnother()">Choose Another</button>
<button class="copy-btn" onclick="copyOutput()">Copy Now</button>
</div>

<video id="video" hidden></video>
<canvas id="canvas" hidden></canvas>

<div id="output">Decoded output will appear here...</div>

</div>

<script>

function showFileName(input){
    if(input.files.length > 0){
        document.getElementById("fileName").innerText =
        "File Uploaded âœ… : " + input.files[0].name;
    }
}

function chooseAnother(){
    document.getElementById("fileInput").value = "";
    document.getElementById("fileName").innerText = "";
    document.getElementById("output").innerText =
    "Decoded output will appear here...";
}

async function decodeQR(){
    const file = document.getElementById("fileInput").files[0];
    if(!file){ alert("Upload file first"); return; }

    if(file.type === "application/pdf"){
        decodePDF(file);
    } else {
        decodeImage(file);
    }
}

function decodeImage(file){
    const reader = new FileReader();
    reader.onload = function(){
        const img = new Image();
        img.onload = function(){
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img,0,0);
            const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
            const code = jsQR(imgData.data, canvas.width, canvas.height);
            if(code){ processData(code.data); }
            else{ output("No QR Found"); }
        };
        img.src = reader.result;
    };
    reader.readAsDataURL(file);
}

async function decodePDF(file){
    const reader = new FileReader();
    reader.onload = async function(){
        const typedarray = new Uint8Array(reader.result);
        const pdf = await pdfjsLib.getDocument(typedarray).promise;
        const page = await pdf.getPage(1);
        const viewport = page.getViewport({scale:2});
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        await page.render({canvasContext:ctx, viewport:viewport}).promise;
        const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
        const code = jsQR(imgData.data, canvas.width, canvas.height);
        if(code){ processData(code.data); }
        else{ output("No QR Found in PDF"); }
    };
    reader.readAsArrayBuffer(file);
}

function processData(data){
    let result = "===== RAW DATA =====\n" + data + "\n\n";

    if(data.includes("upi://pay")){
        const url = new URL(data);
        const upi = url.searchParams.get("pa");
        const name = url.searchParams.get("pn");
        const amt = url.searchParams.get("am");
        const note = url.searchParams.get("tn");

        result += "===== PARSED DETAILS =====\n";
        result += "UPI ID: " + (upi || "N/A") + "\n";
        result += "Name: " + (name || "N/A") + "\n";
        result += "Amount: " + (amt || "N/A") + "\n";
        result += "Note: " + (note || "N/A") + "\n";

        let mobileMatch = data.match(/(\+91)?[6-9]\d{9}/);
        result += "Mobile (Detected): " +
        (mobileMatch ? mobileMatch[0] : "Mobile Number not Connected yet.") + "\n";

        if(upi && /^[6-9]\d{9}@/.test(upi)){
            result += "Mobile (From UPI ID): " +
            upi.split("@")[0] + "\n";
        }
    }

    output(result);
}

function output(text){
    document.getElementById("output").innerText = text;
}

function copyOutput(){
    navigator.clipboard.writeText(
        document.getElementById("output").innerText
    );
    alert("Copied Successfully!");
}

async function startCamera(){
    const video = document.getElementById("video");
    video.hidden = false;
    const stream = await navigator.mediaDevices.getUserMedia(
        {video:{facingMode:"environment"}}
    );
    video.srcObject = stream;
    video.setAttribute("playsinline", true);
    video.play();

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    function scan(){
        if(video.readyState === video.HAVE_ENOUGH_DATA){
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video,0,0);
            const imgData = ctx.getImageData(
                0,0,canvas.width,canvas.height
            );
            const code = jsQR(
                imgData.data,
                canvas.width,
                canvas.height
            );
            if(code){
                processData(code.data);
                stream.getTracks().forEach(t=>t.stop());
                video.hidden = true;
                return;
            }
        }
        requestAnimationFrame(scan);
    }
    scan();
}

</script>

</body>
</html>
